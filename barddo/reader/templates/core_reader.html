{% load static %}
<div id="comic-loading">
    <div>
        <img src="{% static "images/logo.png" %}"/><br/>
        <i class="icon-spinner icon-spin icon-4x"></i>
    </div>
</div>

<div id="comic-help">
    <div class="barddo-info">
        <div class="url"><a href="http://barddo.com">http://barddo.com</a></div>
        <div>Aproximando artistas e leitores!</div>
    </div>

    <div class="navigation-info">
        <p>Clique ou toque nas laterais das páginas para virá-las!</p>
        <small class="hidden-sm">Também é possível usar o t eclado e o mouse para mudar páginas e dar zoom.</small>
        <img class="sample" src="{% static "images/pageturn.png" %}"/>
    </div>

    <div class="toolbar-info">
        <p>Use a barra de ferramentas para dar zoom, colocar em tela cheia ou ver a lista de páginas!</p>

        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-inverse"><i class="icon-zoom-in"></i></button>
            <button type="button" class="btn  btn-inverse"><i class="icon-zoom-out"></i></button>

            <button type="button" class="btn  btn-inverse"><i class="icon-fullscreen"></i></button>
            <button type="button" class="btn  btn-inverse"><i class="icon-th-large"></i></button>
        </div>
    </div>
</div>

<div id="comic-container">
    <div id="comic-wrapper">
        <div id="comic">
            {% for page in work.load_work_pages_without_timestamp %}
                {# Only load the first page from start, others will be load on demand by the wowbook plugin #}
                {% if forloop.first %}
                    <div class="page">
                        <img src="{{ page.url }}" alt="Work page #{{ forloop.counter }}">
                    </div>
                {% else %}
                    <div class="page" data-image="{{ page.url }}">
                    </div>
                {% endif %}
            {% endfor %}

            {# The last page will always be a Barddo promotional page #}
{#            <div class="page">#}
{#                Read more!#}
{#            </div>#}
        </div>
    </div>

    <div style="width: 100%">
        <div id="comic-toolbar">

            <a id="btn-more" class="pull-left" href="http://barddo.com" target="_self"><img src="{% static "images/logo.png" %}" alt="Visite barddo.com"></a>

            <div class="textual-links pull-left">
                <a id="comicInfo" class="btn btn-primary white" href="{{ work.get_absolute_url }}">+ Info</a>
            </div>

            <div class="btn-toolbar  pull-right" role="toolbar">
                <div class="btn-group btn-group-sm">
                    <button id='zoomin' type="button" class="btn btn-inverse"><i class="icon-zoom-in"></i></button>
                    <button id='zoomout' type="button" class="btn  btn-inverse"><i class="icon-zoom-out"></i></button>

                    <button id='fullscreen' type="button" class="btn  btn-inverse"><i class="icon-fullscreen"></i></button>
                    <button id='thumbs' type="button" class="btn  btn-inverse"><i class="icon-th-large"></i></button>
                </div>
                <div class="btn-group btn-group-sm">
                    <button id="readerHelp" type="button" class="btn btn-danger"><i class="icon-question"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            {# Only handle url change when on barddo page (or localhost) and we are not on embed reader url directly #}
            var originalUrl = window.location.href;
            if ((originalUrl.indexOf("barddo.com") >= 0 || originalUrl.indexOf("189.102.122.236") >= 0 ) && originalUrl.indexOf("embed/reader") == -1) {
                window.history.pushState("Barddo Commic", "Comic Viewer", "{{ work.get_absolute_url }}#read");
                $('#readerModal').on('hidden.bs.modal', function () {
                    window.history.pushState("Barddo Commic", "Comic Viewer", originalUrl);
                })
            }

            $.imgpreload('{{ work.get_thumbnail_url }}', function () {
            });

            $('#comic-container').find(".page:first img").waitForImages(function () {
                 setupSizes();

                {# TODO: find a better way to determine then images show be displayed #}
                setTimeout(function () {
                    $("#comic-container").show();
                    setup_reader_for("{{ work.get_thumbnail_url }}");
                    $("#comic-loading").fadeOut("slow");
                }, 1000)
            });

            $("#comic-help").on('click', function () {
                $("#comic-help").fadeOut();
            });

            $("#readerHelp").on('click', function () {
                $("#comic-help").fadeIn();
            });

            $("#comicInfo").on("click", function() {
               $("#comic-information").fadeIn();
            });

            $("#comic-information").on("click", function() {
               $("#comic-information").fadeOut("slow");
            });
        });
    </script>
</div>