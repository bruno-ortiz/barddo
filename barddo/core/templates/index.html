{% extends 'main_template.html' %}
{% load staticfiles %}
{% load compress %}
{% load work_element %}

{% block header %}
    <link rel="stylesheet" href="{% static "css/uncompressed/barddo.gallery.css" %}"/>
    <link rel="stylesheet" href="{% static "css/bottom.css" %}"/>
{% endblock %}

{% block breadcrumbs %}
    <div id="options">
        <ul id="filters" class="option-set clearfix" data-option-key="filter">
            <li><a href="#filter" data-option-value="*" class="selected"><i class="icon icon icon-th-large"></i> All
                Items</a></li>
            <li><a href="#filter" data-option-value=".collection-new"><i class="icon icon-star"></i> New</a></li>
            <li><a href="#filter" data-option-value=".collection-trending"><i class="icon icon-comments"></i> Trending</a>
            </li>
            <li><a href="#filter" data-option-value=".collection-rising"><i class="icon icon-circle-arrow-up"></i>
                Rising</a></li>
        </ul>
    </div>
{% endblock %}

{% block content %}
    <div class="page-content">
        <div class="row">
            <!-- PAGE CONTENT BEGINS -->

            <div id="collection-content" class="col-lg-12  col-md-12 col-sm-12 col-xs-12 collections-wrap">
                <div class="row">
                    <div class="portfolio">
                        {% for work in new_works %}
                            {% work_element work "collection-new" %}
                        {% endfor %}
                        {% for work in rising_works %}
                            {% work_element work "collection-rising" %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->
    </div>
{% endblock %}

{% block page_specific_javascript %}
    {% compress js %}
        <script src="{% static "js/jquery.isotope.min.js" %}"></script>
        <script src="{% static "js/portfolio.js" %}"></script>
        <script type="text/javascript" src="{% static "js/barddo/pages/gallery.js" %}"></script>
    {% endcompress %}
{% endblock %}

{% block bottom_page %}
    <script type="text/javascript">
        $(document).ready(function () {
            {% if next_url %}
                $("#loginModal").modal();
            {% endif %}

            var onPopupHover = false;

            //ROLL ON HOVER
            $(function () {
                var $roll = $(".roll");
                $roll.css("opacity", "0");
                $roll.hover(function () {
                            $(this).css("opacity", 1);
                        },
                        function () {
                            if (!onPopupHover) {
                                $(this).css("opacity", 0);
                            }
                        });
            });

            $(".vote").popover({
                trigger: "manual",
                html: true,
                animation: false,
                placement: "bottom",
                container: "body",
                content: function () {
                    var id = $(this).closest("div[data-work-id]").attr("data-work-id");
                    return $("#work-popup-" + id).html();
                },

                template: '<div class="popover work-popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'
            });

            $(".boxcontainer").on("mouseenter",function () {
                var _this = this;

                var $popover = $(".popover");
                if (!$popover.length) {
                    $(".vote", _this).popover("show");

                    $popover.on("mouseleave", function () {
                        setTimeout(function () {
                            if (!$(".boxcontainer:hover").length) {
                                $(".vote", _this).popover('hide');
                                $(".roll", _this).css("opacity", 0);
                            }
                        }, 100);

                        onPopupHover = false;
                    });
                }

                onPopupHover = true;

            }).on("mouseleave", function () {
                var _this = this;
                setTimeout(function () {
                    if (!$(".popover:hover").length) {
                        onPopupHover = false;
                        $(".vote", _this).popover("hide");
                        $(".roll", _this).css("opacity", 0);
                    }
                }, 100);
            });

            $(document).on("click", ".popover-content button.btn-reader", function () {
                var work_id = $(this).attr("data-work-id");
                Shards.reader(function (shard_id, shard_data, parent) {
                    $(shard_id).remove();
                    $(parent).append(shard_data);
                    $(shard_id).modal('show');
                }, {"work_id": work_id});
            });
        });
    </script>
{% endblock %}